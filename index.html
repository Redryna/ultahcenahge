<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Mini Catch Game - Scrapbook</title>
  <style>
    :root{--bg:#fdeef6;--accent:#ff6b9a}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,var(--bg),#fff);overflow:hidden}
    .wrap{display:flex;flex-direction:column;height:100%}
    h1{font-size:20px;margin:0;color:#333;text-align:center;padding:40px 6px 6px}

    button{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}

    .game-area{position:relative;flex:1;overflow:hidden;border:2px solid rgba(0,0,0,0.1);background:linear-gradient(180deg,#fff,#ffeef6)}
    .basket{position:absolute;bottom:10px;width:100px;height:60px;background:linear-gradient(180deg,#ffd7e3,#ffbcd0);border-radius:15px;display:flex;align-items:center;justify-content:center;font-size:28px;box-shadow:0 4px 10px rgba(0,0,0,0.2)}
    .item{position:absolute;width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:22px}

    /* HUD fix */
    .hud{
      position:fixed;
      top:0;left:0;right:0;
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:8px 12px;
      background:rgba(255,255,255,0.9);
      font-weight:bold;
      font-size:16px;
      z-index:3000;
    }

    .inventory{display:flex;gap:6px;flex-wrap:wrap;padding:6px;background:#fff8;border-radius:10px}
    .inv-item{width:40px;height:40px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:20px}

    .center-overlay{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center;background:#fff9;padding:16px;border-radius:12px;max-width:300px;z-index:2000}
    .center-overlay button{font-size:18px;padding:12px 20px;margin-top:10px}
    .center-overlay p{margin-top:8px;color:#333;font-weight:500}

    #scrapBtn{display:none;margin-top:8px}
    #muteBtn{position:fixed;top:50px;right:10px;background:#fff;border:1px solid #ccc;border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;font-size:16px;z-index:3000}
    #countdown{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);font-size:48px;font-weight:700;color:#ff2d55;display:none;z-index:2500}
  </style>
</head>
<body>
<div class="wrap" id="gameWrap">
  <!-- HUD -->
  <div class="hud">
    <div>‚è≥ <span id="time">30</span>s</div>
    <div>‚≠ê <span id="score">0</span></div>
  </div>

  <h1>üéÅ Tangkap Hadiah üéÅ</h1>

  <div class="game-area" id="gameArea">
    <div class="basket" id="basket">üß∫</div>

    <!-- Overlay Start -->
    <div class="center-overlay" id="overlay">
      <h2>Cara Main</h2>
      <button id="startBtn">Mulai</button>
      <p>Geser jari kiri-kanan untuk menggerakkan keranjang.</p>
      <p>Tangkap hadiah yang jatuh.</p>
      <p>Kumpulkan 300 poin untuk membuka scrapbook!</p>
    </div>
    <div id="countdown"></div>
  </div>

  <h3 style="padding:6px">Inventory</h3>
  <div class="inventory" id="inventory"></div>
  <button id="scrapBtn" onclick="location.href='gelo.html'">üìñ Buka Scrapbook</button>
  <button id="muteBtn">üîä</button>
</div>

<!-- BackSound & SFX -->
<audio id="bgm" src="backsound.mp3" preload="auto" loop></audio>
<audio id="catchSound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>

<script>
const GAME_TIME = 30;
const SPAWN_INTERVAL = 900;
const ITEM_TYPES = [
  {label:'‚ù§', name:'Love'},
  {label:'üå∏', name:'Flower'},
  {label:'‚≠ê', name:'Star'},
  {label:'üéµ', name:'Note'},
  {label:'üì∑', name:'Photo'}
];

const STORAGE_KEY='scrapbook_items_v1';
function load(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]') }catch{ return [] }}
function save(arr){ localStorage.setItem(STORAGE_KEY,JSON.stringify(arr)) }
function addItem(it){ let arr=load(); arr.push(it); save(arr); renderInventory() }
function renderInventory(){ let arr=load(); let inv=document.getElementById('inventory'); inv.innerHTML=''; arr.slice(-12).forEach(it=>{ let d=document.createElement('div'); d.className='inv-item'; d.textContent=it.label; inv.appendChild(d) }) }

const gameArea=document.getElementById('gameArea');
const basket=document.getElementById('basket');
const timeEl=document.getElementById('time');
const scoreEl=document.getElementById('score');
const startBtn=document.getElementById('startBtn');
const overlay=document.getElementById('overlay');
const scrapBtn=document.getElementById('scrapBtn');
const catchSound=document.getElementById('catchSound');
const bgm=document.getElementById('bgm');
const muteBtn=document.getElementById('muteBtn');
const countdown=document.getElementById('countdown');
const gameWrap=document.getElementById('gameWrap');

let width,height,basketX=0;
let spawnTimer=null,gameTimer=null,left=GAME_TIME,score=0,active=false,muted=false;

function recalc(){ let r=gameArea.getBoundingClientRect(); width=r.width; height=r.height; basketX=width/2-basket.offsetWidth/2; basket.style.left=basketX+'px' }
window.addEventListener('resize',()=>{ recalc(); checkOrientation(); }); recalc(); renderInventory();

// Kontrol drag (tekan & geser)
let dragging=false;
gameArea.addEventListener('touchstart',()=>{ dragging=true });
gameArea.addEventListener('touchend',()=>{ dragging=false });
gameArea.addEventListener('touchmove',e=>{
  if(dragging){ moveBasket(e.touches[0].clientX); }
});

function moveBasket(x){ 
  let rect=gameArea.getBoundingClientRect(); 
  let pos=x-rect.left-basket.offsetWidth/2; 
  pos=Math.max(0,Math.min(pos,width-basket.offsetWidth)); 
  basket.style.left=pos+'px' 
}

function spawnItem(){
  let type=ITEM_TYPES[Math.floor(Math.random()*ITEM_TYPES.length)];
  let el=document.createElement('div'); el.className='item'; el.textContent=type.label;
  let x=Math.random()*(width-40); el.style.left=x+'px'; el.style.top='-40px';
  gameArea.appendChild(el);
  let start=performance.now(),duration=3500;
  function anim(t){ 
    let p=(t-start)/duration; 
    if(p>1){el.remove();return} 
    el.style.top=(p*(height-80))+'px';
    if(collide(el.getBoundingClientRect(),basket.getBoundingClientRect())){ catchItem(el,type); return }
    requestAnimationFrame(anim)
  }
  requestAnimationFrame(anim)
}

function collide(a,b){return !(a.right<b.left||a.left>b.right||a.bottom<b.top||a.top>b.bottom)}
function catchItem(el,type){ 
  score+=10; scoreEl.textContent=score; 
  if(!muted){ catchSound.currentTime=0; catchSound.play(); }
  addItem({label:type.label,name:type.name,time:Date.now()}); 
  el.remove();
  if(score>=300){ scrapBtn.style.display='block'; }
}

function startGame(){ 
  if(active) return; 
  overlay.style.display='none';

  // AUTO FULLSCREEN
  if(gameWrap.requestFullscreen){ 
    gameWrap.requestFullscreen().catch(()=>{}); 
  }

  // AUTO LANDSCAPE
  if(screen.orientation && screen.orientation.lock){ 
    screen.orientation.lock("landscape").catch(()=>{
      alert("Silakan putar HP ke mode landscape untuk main lebih nyaman!");
    }); 
  }

  // Countdown
  let c=3;
  countdown.style.display='block';
  countdown.textContent=c;
  let timer=setInterval(()=>{
    c--;
    if(c>0){ countdown.textContent=c; }
    else if(c===0){ countdown.textContent="GO!"; }
    else{
      clearInterval(timer);
      countdown.style.display='none';
      beginPlay();
    }
  },1000);
}

function beginPlay(){
  active=true; score=0;scoreEl.textContent=score;left=GAME_TIME;timeEl.textContent=left;
  if(!muted){ bgm.currentTime=0; bgm.play(); }
  spawnTimer=setInterval(spawnItem,SPAWN_INTERVAL);
  gameTimer=setInterval(()=>{ left--; timeEl.textContent=left; if(left<=0) endGame() },1000);
  spawnItem();
}

function endGame(){ 
  active=false; 
  clearInterval(spawnTimer);clearInterval(gameTimer);
  spawnTimer=null;gameTimer=null;
  bgm.pause();
  overlay.style.display='block'; startBtn.disabled=false;
}

startBtn.addEventListener('click',startGame);
muteBtn.addEventListener('click',()=>{ 
  muted=!muted; 
  if(muted){ bgm.pause(); muteBtn.textContent="üîá"; } 
  else { if(active){ bgm.play(); } muteBtn.textContent="üîä"; }
});

// cek orientasi awal
function checkOrientation(){
  if(window.innerHeight > window.innerWidth){
    alert("Putar HP ke mode landscape untuk main lebih nyaman!");
  }
}
checkOrientation();
</script>
</body>
</html>

